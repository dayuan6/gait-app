<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI æ­¥æ€åˆ†æåŠ©æ‰‹</title>
    <!-- å¼•å…¥ Tailwind CSS è¿›è¡Œæ ·å¼è®¾è®¡ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Alpine.js å¤„ç†é¡µé¢äº¤äº’é€»è¾‘ -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- å¼•å…¥å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* æ¨¡æ‹Ÿç§»åŠ¨ç«¯APPçš„å®¹å™¨æ ·å¼ */
        body { background-color: #f3f4f6; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .app-container { max-width: 480px; margin: 0 auto; background: white; min-height: 100vh; position: relative; padding-bottom: 80px; box-shadow: 0 0 20px rgba(0,0,0,0.05); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* ç®€å•çš„åŠ è½½åŠ¨ç”» */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* è§†é¢‘å®¹å™¨ */
        video { object-fit: cover; width: 100%; height: 100%; border-radius: 0.75rem; }
    </style>
</head>

<body>

<!-- Alpine.js æ•°æ®çŠ¶æ€ç®¡ç† -->
<div x-data="appData()" class="app-container">

    <!-- ================= é¡¶éƒ¨å¯¼èˆªæ  (æ ¹æ®é¡µé¢åŠ¨æ€å˜åŒ–) ================= -->
    <header class="bg-blue-500 text-white p-4 sticky top-0 z-10 shadow-md">
        <div class="flex items-center justify-between h-8">
            <!-- é¦–é¡µæ¨¡å¼ -->
            <template x-if="currentPage === 'home'">
                <div class="flex items-center gap-2">
                    <span class="text-lg font-medium">æ‚¨å¥½ï¼Œæå¥³å£« ğŸ‘‹</span>
                </div>
            </template>

            <!-- éé¦–é¡µæ¨¡å¼ (å¸¦è¿”å›æŒ‰é’®) -->
            <template x-if="currentPage !== 'home'">
                <div class="flex items-center w-full">
                    <button @click="goHome()" class="mr-4 text-xl"><i class="fas fa-chevron-left"></i></button>
                    <span class="text-lg font-medium mx-auto transform -translate-x-4" x-text="getPageTitle()"></span>
                </div>
            </template>
        </div>
    </header>

    <!-- ================= 1. é¦–é¡µ (Home) ================= -->
    <div x-show="currentPage === 'home'" class="p-4 space-y-6 fade-in">
        
        <!-- æœ€è¿‘æŠ¥å‘Šå¡ç‰‡ -->
        <div class="bg-white border border-gray-100 rounded-2xl shadow-lg p-5">
            <h3 class="text-gray-700 font-semibold mb-4">æ‚¨æœ€è¿‘çš„æ­¥æ€åˆ†ææŠ¥å‘Š</h3>
            <p class="text-xs text-gray-400 mb-6">åˆ†ææ—¥æœŸ: 2025å¹´10æœˆ28æ—¥</p>

            <div class="space-y-4 mb-6">
                <div class="flex justify-between items-center border-b border-gray-50 pb-2">
                    <span class="text-gray-600">æ•´ä½“æ­¥æ€è¯„åˆ†</span>
                    <span class="text-blue-600 font-bold text-xl">82 <span class="text-sm text-gray-400 font-normal">/ 100</span></span>
                </div>
                <div class="flex justify-between items-center border-b border-gray-50 pb-2">
                    <span class="text-gray-600">å¹³è¡¡æ€§</span>
                    <span class="text-green-500 font-medium">ç¨³å®š</span>
                </div>
                <div class="flex justify-between items-center pb-2">
                    <span class="text-gray-600">æ­¥é¢‘</span>
                    <span class="text-blue-500 font-medium">ç•¥æœ‰æ”¹å–„</span>
                </div>
            </div>

            <button @click="viewReport(sampleReport)" class="w-full bg-blue-500 text-white py-3 rounded-xl font-medium hover:bg-blue-600 transition flex items-center justify-center gap-2">
                æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š <i class="fas fa-arrow-right text-sm"></i>
            </button>
        </div>

        <!-- æœ€æ–°æˆå°± -->
        <div>
            <h4 class="text-gray-500 text-sm font-bold mb-3">æœ€æ–°æˆå°±</h4>
            <div class="flex gap-3">
                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1">
                    <i class="fas fa-check-circle"></i> å¹³è¡¡æ€§æ”¹å–„
                </span>
                <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1">
                    <i class="fas fa-chart-line"></i> æ­¥é¢‘ç¨³å®š
                </span>
            </div>
        </div>

        <!-- ä¸‹ä¸€æ­¥è¡ŒåŠ¨ -->
        <div>
            <h4 class="text-gray-500 text-sm font-bold mb-3">ä¸‹ä¸€æ­¥</h4>
            <p class="text-xs text-gray-400 mb-3">å½•åˆ¶æ–°çš„è¡Œèµ°è§†é¢‘ä»¥æ›´æ–°æ‚¨çš„æ­¥æ€æŠ¥å‘Š</p>
            <button @click="startRecordingFlow()" class="w-full bg-white border border-blue-400 text-blue-500 py-3 rounded-xl font-medium hover:bg-blue-50 transition">
                å½•åˆ¶æ–°æ­¥æ€è§†é¢‘
            </button>
        </div>
    </div>

    <!-- ================= 2. å½•åˆ¶é¡µ (Record) ================= -->
    <div x-show="currentPage === 'record'" class="p-4 flex flex-col h-[85vh]">
        
        <!-- è§†é¢‘å–æ™¯æ¡† -->
        <div class="flex-grow bg-gray-200 rounded-xl overflow-hidden relative mb-6 shadow-inner flex items-center justify-center">
            
            <!-- æ‘„åƒå¤´æœªå¼€å¯çŠ¶æ€ -->
            <div x-show="!cameraActive && !isAnalyzing" class="text-center text-gray-400">
                <i class="fas fa-video text-4xl mb-2"></i>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å¯æ‘„åƒå¤´</p>
            </div>

            <!-- æ‘„åƒå¤´ç”»é¢ -->
            <video x-ref="videoFeed" x-show="cameraActive" autoplay playsinline muted class="absolute inset-0 w-full h-full bg-black"></video>

            <!-- å½•åˆ¶ä¸­çš„è¦†ç›–å±‚ -->
            <div x-show="isRecording" class="absolute top-4 right-4 bg-red-500 text-white px-3 py-1 rounded-full text-xs animate-pulse">
                REC 00:<span x-text="timer"></span>
            </div>
        </div>

        <!-- æ“ä½œåŒºåŸŸ -->
        <div class="space-y-4">
            <!-- æŒ‰é’®çŠ¶æ€åˆ‡æ¢ -->
            <template x-if="!isAnalyzing">
                <button 
                    @click="toggleCameraAction()" 
                    :class="isRecording ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-500 hover:bg-blue-600'"
                    class="w-full text-white py-4 rounded-xl font-bold text-lg shadow-lg transition transform active:scale-95">
                    <span x-text="getButtonText()"></span>
                </button>
            </template>

            <!-- AI åˆ†æä¸­çŠ¶æ€ (æ¨¡æ‹Ÿ) -->
            <div x-show="isAnalyzing" class="bg-blue-50 border border-blue-100 rounded-xl p-4 flex items-center gap-4">
                <div class="loader flex-shrink-0"></div>
                <div>
                    <h4 class="text-blue-800 font-bold text-sm">AI æ­£åœ¨åˆ†æä¸­...</h4>
                    <p class="text-blue-600 text-xs mt-1">æ­£åœ¨ä¸Šä¼ äº‘ç«¯å¹¶è®¡ç®—å…³èŠ‚è§’åº¦ä¸æ­¥æ€å‚æ•°</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= 3. æŠ¥å‘Šé¡µ (Report) - å¡«è¡¥ç»†èŠ‚ ================= -->
    <div x-show="currentPage === 'report'" class="p-4 space-y-4">
        
        <!-- æ€»åˆ†ä»ªè¡¨ç›˜ -->
        <div class="bg-white rounded-2xl p-6 shadow-sm text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-blue-500"></div>
            <p class="text-gray-500 text-sm mb-2">ç»¼åˆæ­¥æ€è¯„åˆ†</p>
            <h1 class="text-5xl font-bold text-blue-600 mb-2">85</h1>
            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs">çŠ¶æ€ï¼šä¼˜ç§€</span>
        </div>

        <!-- è¯¦ç»†æ•°æ®ç½‘æ ¼ -->
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                <p class="text-gray-400 text-xs">æ­¥é¢‘ (æ­¥/åˆ†)</p>
                <p class="text-xl font-bold text-gray-800 mt-1">112 <span class="text-xs font-normal text-green-500">â†‘ æ­£å¸¸</span></p>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                <p class="text-gray-400 text-xs">å¹³å‡æ­¥å¹… (cm)</p>
                <p class="text-xl font-bold text-gray-800 mt-1">62 <span class="text-xs font-normal text-yellow-500">â†“ åå°</span></p>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                <p class="text-gray-400 text-xs">åŒè„šæ”¯æ’‘æœŸ</p>
                <p class="text-xl font-bold text-gray-800 mt-1">22% <span class="text-xs font-normal text-gray-400">æ ‡å‡†</span></p>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                <p class="text-gray-400 text-xs">å¯¹ç§°æ€§åå·®</p>
                <p class="text-xl font-bold text-gray-800 mt-1">3.5% <span class="text-xs font-normal text-green-500">è‰¯å¥½</span></p>
            </div>
        </div>

        <!-- æ­¥æ€é—®é¢˜åˆ†æ -->
        <div class="bg-white rounded-2xl p-5 shadow-sm">
            <h3 class="font-bold text-gray-700 mb-4 border-l-4 border-blue-500 pl-3">AI è¯Šæ–­å»ºè®®</h3>
            <ul class="space-y-3">
                <li class="flex items-start gap-3">
                    <i class="fas fa-exclamation-circle text-yellow-500 mt-1"></i>
                    <p class="text-sm text-gray-600">æ£€æµ‹åˆ°<span class="font-bold text-gray-800">å·¦è…¿æŠ¬èµ·é«˜åº¦ç•¥ä½</span>ï¼Œå¯èƒ½å­˜åœ¨è½»å¾®çš„æ‹–æ­¥ç°è±¡ã€‚</p>
                </li>
                <li class="flex items-start gap-3">
                    <i class="fas fa-check-circle text-green-500 mt-1"></i>
                    <p class="text-sm text-gray-600">ä¸Šèº«å§¿æ€ä¿æŒè‰¯å¥½ï¼Œæ‘†è‡‚å¹…åº¦å¯¹ç§°ã€‚</p>
                </li>
            </ul>
        </div>

        <button @click="goHome()" class="w-full border border-gray-300 text-gray-600 py-3 rounded-xl mt-4 hover:bg-gray-50">è¿”å›é¦–é¡µ</button>
    </div>

    <!-- ================= 4. å†å²è®°å½• (History) - å¡«è¡¥ç»†èŠ‚ ================= -->
    <div x-show="currentPage === 'history'" class="p-4">
        <div class="space-y-4">
            <!-- å†å²åˆ—è¡¨é¡¹ 1 -->
            <div class="bg-white p-4 rounded-xl shadow-sm flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center text-blue-600 font-bold text-lg">85</div>
                    <div>
                        <p class="font-bold text-gray-800">åˆšåˆš</p>
                        <p class="text-xs text-gray-400">å½•åˆ¶æ—¶é•¿ 00:15</p>
                    </div>
                </div>
                <button class="text-gray-400 hover:text-blue-500"><i class="fas fa-chevron-right"></i></button>
            </div>

            <!-- å†å²åˆ—è¡¨é¡¹ 2 -->
            <div class="bg-white p-4 rounded-xl shadow-sm flex items-center justify-between opacity-80">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-50 w-12 h-12 rounded-lg flex items-center justify-center text-blue-600 font-bold text-lg">82</div>
                    <div>
                        <p class="font-bold text-gray-800">2025å¹´10æœˆ28æ—¥</p>
                        <p class="text-xs text-gray-400">ä¸‹åˆ 14:30</p>
                    </div>
                </div>
                <button class="text-gray-400 hover:text-blue-500"><i class="fas fa-chevron-right"></i></button>
            </div>

             <!-- å†å²åˆ—è¡¨é¡¹ 3 -->
             <div class="bg-white p-4 rounded-xl shadow-sm flex items-center justify-between opacity-60">
                <div class="flex items-center gap-4">
                    <div class="bg-yellow-50 w-12 h-12 rounded-lg flex items-center justify-center text-yellow-600 font-bold text-lg">76</div>
                    <div>
                        <p class="font-bold text-gray-800">2025å¹´10æœˆ15æ—¥</p>
                        <p class="text-xs text-gray-400">ä¸Šåˆ 09:15</p>
                    </div>
                </div>
                <button class="text-gray-400 hover:text-blue-500"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    <!-- ================= åº•éƒ¨ Tab å¯¼èˆª ================= -->
    <nav class="fixed bottom-0 w-full max-w-[480px] bg-white border-t border-gray-200 flex justify-around py-3 pb-5 text-xs text-gray-400 z-50">
        <button @click="changeTab('home')" :class="currentPage === 'home' ? 'text-blue-500' : 'hover:text-gray-600'" class="flex flex-col items-center gap-1">
            <i class="fas fa-home text-xl"></i>
            <span>é¦–é¡µ</span>
        </button>
        <button @click="startRecordingFlow()" :class="currentPage === 'record' ? 'text-blue-500' : 'hover:text-gray-600'" class="flex flex-col items-center gap-1">
            <div class="bg-blue-500 text-white rounded-full p-3 -mt-6 shadow-lg border-4 border-white">
                <i class="fas fa-video text-lg"></i>
            </div>
            <span class="mt-1">å½•åˆ¶</span>
        </button>
        <button @click="changeTab('history')" :class="currentPage === 'history' ? 'text-blue-500' : 'hover:text-gray-600'" class="flex flex-col items-center gap-1">
            <i class="fas fa-history text-xl"></i>
            <span>å†å²</span>
        </button>
        <button class="flex flex-col items-center gap-1 hover:text-gray-600">
            <i class="fas fa-user text-xl"></i>
            <span>æˆ‘çš„</span>
        </button>
    </nav>

</div>

<script>
    function appData() {
        return {
            currentPage: 'home', // home, record, report, history
            cameraActive: false,
            isRecording: false,
            isAnalyzing: false,
            timer: 15,
            stream: null,
            sampleReport: {}, // è¿™é‡Œå¯ä»¥å­˜æ”¾å…·ä½“çš„æŠ¥å‘Šæ•°æ®å¯¹è±¡

            // é¡µé¢æ ‡é¢˜é€»è¾‘
            getPageTitle() {
                switch(this.currentPage) {
                    case 'record': return 'å½•åˆ¶æ–°æ­¥æ€è§†é¢‘';
                    case 'report': return 'å®Œæ•´æ­¥æ€åˆ†ææŠ¥å‘Š';
                    case 'history': return 'å†å²æŠ¥å‘Š';
                    default: return '';
                }
            },

            // åˆ‡æ¢ Tab
            changeTab(page) {
                this.stopCamera(); // åˆ‡æ¢é¡µé¢æ—¶å…³é—­æ‘„åƒå¤´
                this.currentPage = page;
                window.scrollTo(0,0);
            },

            // è¿”å›é¦–é¡µ
            goHome() {
                this.changeTab('home');
                this.isAnalyzing = false;
                this.isRecording = false;
            },

            // å¼€å§‹å½•åˆ¶æµç¨‹
            startRecordingFlow() {
                this.currentPage = 'record';
                // è‡ªåŠ¨å¼€å¯æ‘„åƒå¤´ (çœŸå®è°ƒç”¨)
                this.$nextTick(() => {
                    this.startCamera();
                });
            },

            // æ‘„åƒå¤´é€»è¾‘
            async startCamera() {
                try {
                    this.stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false });
                    this.$refs.videoFeed.srcObject = this.stream;
                    this.cameraActive = true;
                } catch (err) {
                    alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™æˆ–ä½¿ç”¨HTTPSç¯å¢ƒã€‚");
                    console.error(err);
                }
            },

            stopCamera() {
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                this.cameraActive = false;
            },

            // æŒ‰é’®é€»è¾‘ï¼šå¼€å§‹å½•åˆ¶ -> åœæ­¢å½•åˆ¶ -> åˆ†æ
            toggleCameraAction() {
                if (!this.cameraActive) {
                    this.startCamera();
                    return;
                }

                if (!this.isRecording) {
                    // å¼€å§‹å½•åˆ¶
                    this.isRecording = true;
                    this.timer = 15;
                    // æ¨¡æ‹Ÿå€’è®¡æ—¶
                    this.timerInterval = setInterval(() => {
                        if(this.timer > 0) this.timer--;
                    }, 1000);
                } else {
                    // åœæ­¢å½•åˆ¶å¹¶å¼€å§‹åˆ†æ
                    this.finishRecording();
                }
            },

            getButtonText() {
                if (!this.cameraActive) return 'å¼€å¯æ‘„åƒå¤´';
                if (this.isRecording) return 'å®Œæˆå½•åˆ¶ (ç‚¹å‡»åœæ­¢)';
                return 'å¼€å§‹å½•åˆ¶æ­¥æ€è§†é¢‘';
            },

            finishRecording() {
                clearInterval(this.timerInterval);
                this.isRecording = false;
                this.stopCamera(); // åœæ­¢æ‘„åƒå¤´æµ
                this.isAnalyzing = true;

                // æ¨¡æ‹Ÿ AI åç«¯åˆ†æè¿‡ç¨‹ (å»¶è¿Ÿ3ç§’)
                setTimeout(() => {
                    this.isAnalyzing = false;
                    this.currentPage = 'report'; // è·³è½¬åˆ°æŠ¥å‘Šé¡µ
                }, 3000);
            },
            
            viewReport(reportData) {
                this.currentPage = 'report';
                window.scrollTo(0,0);
            }
        }
    }
</script>

</body>

</html>
